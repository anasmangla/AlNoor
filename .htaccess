RewriteEngine On

# Canonical: force HTTPS and primary host
RewriteCond %{HTTPS} !=on [OR]
RewriteCond %{HTTP_HOST} !^alnoorfarm716\.com$ [NC]
RewriteRule ^ https://alnoorfarm716.com%{REQUEST_URI} [L,R=301]

# Prevent directory listings
Options -Indexes

# Serve root index statically; Next app runs under /alnoor
DirectoryIndex index.html index.php

# Pass-through: Next app (/alnoor), API (/api), Next assets (/_next), and site assets (/assets)
RewriteRule ^(alnoor|api|_next)(/.*)?$ - [L]
RewriteRule ^assets/(.*)$ - [L]

# Root fallback: if not a real file/dir, serve index.html
RewriteCond %{REQUEST_URI} ^/$
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^$ index.html [L]

# Compression
AddOutputFilterByType DEFLATE text/html text/css application/javascript application/json image/svg+xml

# Static caching
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType text/css "access plus 7 days"
  ExpiresByType application/javascript "access plus 7 days"
  ExpiresByType image/png "access plus 30 days"
  ExpiresByType image/jpeg "access plus 30 days"
  ExpiresByType image/svg+xml "access plus 30 days"
</IfModule>

# Safety: strip leaked filesystem paths (BlueHost paths) back to clean web paths
RewriteCond %{REQUEST_URI} ^/home\d+/.+?/public_html/website_18b31db5/(.*)$ [NC]
RewriteRule ^home\d+/.+?/public_html/website_18b31db5/(.*)$ /$1 [L,R=302]

# Shortcuts at root
RewriteRule ^store/?$ /alnoor/products [L,R=302]
RewriteRule ^pos/?$ /alnoor/admin/pos [L,R=302]
RewriteRule ^admin/?$ /alnoor/admin/login [L,R=302]

