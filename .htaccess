RewriteEngine On
# Force HTTPS and non-www
RewriteCond %{HTTPS} !=on [OR]
RewriteCond %{HTTP_HOST} ^www\. [NC]
RewriteRule ^ https://alnoorfarm716.com%{REQUEST_URI} [L,R=301]

# Redirect short paths to Next.js app under /alnoor
RewriteRule ^store/?$ alnoor/products [L,R=302]
RewriteRule ^admin/?$ alnoor/admin/login [L,R=302]
RewriteRule ^pos/?$   alnoor/admin/pos [L,R=302]

# Set root index to /public/index.html
DirectoryIndex public/index.html index.html index.php

# Prevent directory listings
Options -Indexes

# Redirect the site root to the Next.js app under /alnoor
RewriteCond %{REQUEST_URI} ^/$
RewriteRule ^$ alnoor/ [L,R=302]

# Fallback: for any non-existent file/dir, serve /public/index.html
# But do not rewrite app/API subpaths (adjust as needed)
RewriteCond %{REQUEST_URI} !^/alnoor(/|$)
RewriteCond %{REQUEST_URI} !^/api(/|$)
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^ public/index.html [L]

# Compression
AddOutputFilterByType DEFLATE text/html text/css application/javascript application/json image/svg+xml

# Static caching
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType text/css "access plus 7 days"
  ExpiresByType application/javascript "access plus 7 days"
  ExpiresByType image/png "access plus 30 days"
  ExpiresByType image/jpeg "access plus 30 days"
  ExpiresByType image/svg+xml "access plus 30 days"
</IfModule>
